[include shell_command.cfg]
[include mainsail.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_1C0040001851313338343730-if00

[mcu zz]
serial: /dev/serial/by-id/usb-Klipper_rp2040_454741505A8E87FA-if00

[mcu ebb36]
canbus_uuid: 8bb6b5d87c0a

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[exclude_object]

[force_move]
enable_force_move: True

[respond]
default_type: echo
default_prefix:

[cartographer]
canbus_uuid: a646294fb1b6

speed: 5.
lift_speed: 5.
backlash_comp: 0.5
x_offset: 0
y_offset: 0
trigger_distance: 2.
trigger_dive_threshold: 1.5
trigger_hysteresis: 0.006
cal_nozzle_z: 0.1
cal_floor: 0.1
cal_ceil:5.
cal_speed: 1.0
cal_move_speed: 5.
default_model_name: default
mesh_main_direction: x
mesh_cluster_size: 1
mesh_runs: 2

[include led.cfg]
[include KAMP_Settings.cfg]
[include start.cfg]
[include end.cfg]
[include m600.cfg]
[include tachometer.cfg]
[include habibi.cfg]

[printer]
kinematics: corexy
max_velocity: 450
max_accel: 5000
max_z_velocity: 10

[safe_z_home]
home_xy_position: 125,125
z_hop: 20

[bed_mesh]
speed: 150
horizontal_move_z: 15
mesh_min: 35, 0
mesh_max: 200, 175
probe_count: 21, 21
algorithm: bicubic
mesh_pps: 0, 0

[z_tilt]
z_positions:
    -25, -100         #vorne links
    120, 345      #hinten mitte
    295, -100          #vorne rechts
    
points:
    25, 0         #vorne links
    120, 175      #hinten mitte
    215, 0          #vorne rechts

speed: 80
horizontal_move_z: 12
retries: 20
retry_tolerance: 0.005

# S1
[stepper_y1]
step_pin: PC14
dir_pin: !PC13
enable_pin: !PE6
microsteps: 32
rotation_distance: 40

# S2
[stepper_x]
step_pin: PE5
dir_pin: !PE4
enable_pin: !PE3
microsteps: 32
rotation_distance: 40
endstop_pin: ebb36:PB6
position_endstop: 245
position_max: 245
homing_speed: 55

# S3
[stepper_y]
step_pin: PE2
dir_pin: !PE1
enable_pin: !PE0
microsteps: 32
rotation_distance: 40
position_max: 200
endstop_pin: PF0
position_endstop: 225
position_max: 225
homing_speed: 55

# S4
[stepper_x1]
step_pin: PB9
dir_pin: !PB8
enable_pin: !PB7
microsteps: 32
rotation_distance: 40

[autotune_tmc stepper_x]
motor: moons-ms17hd6p4200
voltage: 48
#tuning_goal: perfomance

[autotune_tmc stepper_x1]
motor: moons-ms17hd6p4200
voltage: 48
#tuning_goal: perfomance

[autotune_tmc stepper_y]
motor: moons-ms17hd6p4200
voltage: 48
#tuning_goal: perfomance

[autotune_tmc stepper_y1]
motor: moons-ms17hd6p4200
voltage: 48
#tuning_goal: perfomance

[stepper_z]
step_pin: zz:gpio19
dir_pin: !zz:gpio28
enable_pin: !zz:gpio2
microsteps: 32
gear_ratio: 80:16
rotation_distance: 40
position_min: -2
position_max: 200
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0
homing_speed: 5
second_homing_speed: 3

[stepper_z1]
step_pin: zz:gpio6
dir_pin: !zz:gpio5
enable_pin: !zz:gpio7
microsteps: 32
gear_ratio: 80:16
rotation_distance: 40
#position_max: 200

[stepper_z2]
step_pin: zz:gpio11
dir_pin: zz:gpio10
enable_pin: !zz:gpio12
microsteps: 32
gear_ratio: 80:16
rotation_distance: 40
#position_max: 200

# S5
[extruder]
step_pin: ebb36:PD0
dir_pin: ebb36:PD1
enable_pin: !ebb36:PD2
rotation_distance: 45.110
gear_ratio: 9:1
microsteps: 16
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: ebb36:PB13
sensor_pin:  ebb36:PA3
sensor_type: PT1000
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0
max_temp: 280
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
max_extrude_cross_section: 5
pressure_advance: 0.044

[heater_bed]
heater_pin: PF5
sensor_pin: PB0
sensor_type: ATC Semitec 104GT-2
#control: watermark
min_temp: 0
max_temp: 130

[fan]
pin: ebb36:PA0
max_power: 1.0
kick_start_time: 0.5
off_below: 0.13
cycle_time: 0.001

[heater_fan hotend_fan]
pin: ebb36:PB3
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
tachometer_pin: ^ebb36:PB4
tachometer_poll_interval: 0.0012

[fan_generic stepper1]
pin: PA0
max_power: 1.0
off_below: 0.13
cycle_time: 0.001

[fan_generic stepper2]
pin: PA1
max_power: 1.0
off_below: 0.13
cycle_time: 0.001

[fan_generic stepper3]
pin: PA2
max_power: 1.0
off_below: 0.13
cycle_time: 0.001

[fan_generic stepper4]
pin: PA3
max_power: 1.0
off_below: 0.13
cycle_time: 0.001

########################################
# TMC2160 configuration
########################################

[tmc5160 stepper_y]
cs_pin: PD6
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
##diag1_pin: PC15
run_current: 0.9
sense_resistor: 0.022
stealthchop_threshold: 0

[tmc5160 stepper_y1]
cs_pin: PD5
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
##diag1_pin: PF0
run_current: 0.9
sense_resistor: 0.022
stealthchop_threshold: 0

[tmc5160 stepper_x]
cs_pin: PD4
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
##diag1_pin: PF1
run_current: 0.9
sense_resistor: 0.022
stealthchop_threshold: 0

[tmc5160 stepper_x1]
cs_pin: PD3
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
##diag1_pin: PF2
run_current: 0.9
sense_resistor: 0.022
stealthchop_threshold: 0

[tmc2209 extruder]
uart_pin: ebb36:PA15
#tx_pin: ebb36:PB1
#uart_address: 3
interpolate: False
run_current: 0.85
sense_resistor: 0.110
stealthchop_threshold: 0

[tmc2209 stepper_z]
uart_pin: zz:gpio9
tx_pin: zz:gpio8
uart_address: 1
interpolate: False
run_current: 0.9
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z1]
uart_pin: zz:gpio9
tx_pin: zz:gpio8
uart_address: 2
interpolate: False
run_current: 0.9
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z2]
uart_pin: zz:gpio9
tx_pin: zz:gpio8
uart_address: 0
interpolate: False
run_current: 0.9
sense_resistor: 0.110
stealthchop_threshold: 999999

[board_pins]
aliases:
    # FPC header, Aliases EXP1 & EXP2 for mini12864
    EXP1_1=PG5, EXP1_2=PG4,
    EXP1_3=PG3, EXP1_4=PG2,
    EXP1_5=PD15, EXP1_6=PD14,
    EXP1_7=PD13, EXP1_8=PD12,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PG8, EXP2_4=PE11,
    EXP2_5=PG7, EXP2_6=PE14,
    EXP2_7=PG6, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>

[lis2dw]
cs_pin: cartographer:PA3
spi_bus: spi1

[resonance_tester]
accel_chip: lis2dw
probe_points:
    120, 125, 20

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 24.376
#*# pid_ki = 1.935
#*# pid_kd = 76.785
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 57.850
#*# pid_ki = 2.775
#*# pid_kd = 301.542
#*#
#*# [cartographer model default]
#*# model_coef = 1.4616799634972861,
#*# 	  1.8877428145927933,
#*# 	  0.7481624096550444,
#*# 	  0.3497821012036682,
#*# 	  0.3813041084463559,
#*# 	  0.32561550461773914,
#*# 	  -0.30438331787897105,
#*# 	  -0.32666403827218443,
#*# 	  0.2628862708307318,
#*# 	  0.21512264634973188
#*# model_domain = 3.285084785326086e-07,3.359497231964182e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 29.222469
#*# model_offset = -0.96000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.010968, 0.003242, -0.002385, -0.003194, -0.002666, -0.006848, -0.010784, -0.008512, -0.004530, -0.001303, -0.002837, -0.002489, 0.001700, 0.005364, 0.011272, 0.015097, 0.012707, 0.011031, 0.011097, 0.011542, 0.010985
#*# 	  0.005606, 0.001432, -0.002556, -0.003247, -0.001133, -0.004890, -0.009411, -0.008445, -0.002571, -0.000247, -0.000582, 0.000689, 0.004694, 0.008979, 0.014804, 0.017275, 0.014902, 0.014655, 0.014924, 0.016289, 0.015805
#*# 	  0.006159, 0.001436, -0.000506, 0.000286, 0.001390, -0.000217, -0.006265, -0.004536, 0.000826, 0.004878, 0.003422, 0.005210, 0.010022, 0.014632, 0.018704, 0.020627, 0.019642, 0.019764, 0.020770, 0.022520, 0.023494
#*# 	  0.009565, 0.007169, 0.003515, 0.005357, 0.007158, 0.005266, -0.000371, -0.000608, 0.005256, 0.010059, 0.010916, 0.011107, 0.015363, 0.019547, 0.024462, 0.026826, 0.026397, 0.026454, 0.028610, 0.029990, 0.031097
#*# 	  0.012961, 0.010058, 0.008335, 0.008726, 0.010932, 0.010993, 0.004698, 0.003593, 0.011036, 0.016375, 0.016902, 0.016812, 0.020254, 0.023979, 0.030036, 0.032296, 0.032172, 0.033009, 0.034795, 0.037295, 0.038999
#*# 	  0.015021, 0.012933, 0.009709, 0.009519, 0.011037, 0.012903, 0.006177, 0.004660, 0.012190, 0.017628, 0.016839, 0.017706, 0.021519, 0.025960, 0.032330, 0.036861, 0.037310, 0.037819, 0.038641, 0.039768, 0.041071
#*# 	  0.012382, 0.008650, 0.006539, 0.006147, 0.008116, 0.008932, 0.003320, 0.003265, 0.008795, 0.014536, 0.014819, 0.015322, 0.019432, 0.024440, 0.032429, 0.039090, 0.038564, 0.039485, 0.039821, 0.041226, 0.041896
#*# 	  0.008789, 0.006166, 0.003248, 0.003281, 0.005804, 0.006176, 0.001411, 0.001314, 0.006916, 0.012849, 0.013452, 0.014997, 0.019335, 0.024598, 0.033698, 0.041530, 0.041657, 0.043246, 0.043249, 0.043509, 0.046754
#*# 	  0.009987, 0.005472, 0.001731, 0.001814, 0.003780, 0.003625, -0.000362, -0.000808, 0.004378, 0.011618, 0.014794, 0.016838, 0.022509, 0.029251, 0.037347, 0.043485, 0.045370, 0.045397, 0.046390, 0.046829, 0.049292
#*# 	  0.010886, 0.007382, 0.003285, 0.000448, 0.003245, 0.003277, -0.000587, -0.002089, 0.003316, 0.010593, 0.014708, 0.016755, 0.022571, 0.030389, 0.039855, 0.047287, 0.049295, 0.050155, 0.049808, 0.051316, 0.054010
#*# 	  0.010879, 0.007058, 0.001400, -0.001096, 0.000337, 0.001511, -0.000692, -0.002685, 0.001554, 0.009050, 0.012912, 0.015806, 0.021568, 0.030181, 0.041115, 0.048557, 0.050112, 0.049201, 0.050352, 0.052811, 0.054753
#*# 	  0.009088, 0.005047, -0.000676, -0.002506, -0.002505, -0.000196, -0.004201, -0.004522, 0.000385, 0.006780, 0.010945, 0.012945, 0.018771, 0.028297, 0.039648, 0.045858, 0.047223, 0.047227, 0.049396, 0.052040, 0.052962
#*# 	  0.005145, -0.000283, -0.005920, -0.007502, -0.006464, -0.005338, -0.008151, -0.008837, -0.004252, 0.003080, 0.005442, 0.007302, 0.014656, 0.024478, 0.034860, 0.039720, 0.041148, 0.042816, 0.045386, 0.047819, 0.049096
#*# 	  0.000325, -0.005010, -0.011237, -0.013014, -0.012265, -0.010296, -0.011701, -0.012264, -0.007173, -0.001092, 0.001335, 0.001725, 0.009036, 0.019096, 0.029689, 0.035870, 0.037038, 0.038017, 0.041660, 0.045343, 0.047255
#*# 	  -0.002536, -0.006650, -0.014214, -0.016122, -0.014517, -0.011402, -0.011818, -0.012250, -0.008037, -0.002232, -0.000522, -0.000511, 0.006416, 0.017371, 0.027601, 0.035166, 0.036694, 0.037636, 0.040176, 0.045093, 0.047186
#*# 	  0.000850, -0.003497, -0.011292, -0.014141, -0.012160, -0.008166, -0.006444, -0.009569, -0.006468, -0.001102, 0.001402, 0.001353, 0.007747, 0.018639, 0.030146, 0.037831, 0.039942, 0.041607, 0.042521, 0.045790, 0.050824
#*# 	  0.007825, 0.003022, -0.004459, -0.007370, -0.004447, 0.000206, -0.000642, -0.003490, -0.001983, 0.003259, 0.005475, 0.007001, 0.013072, 0.022653, 0.033982, 0.043488, 0.046094, 0.045653, 0.047091, 0.050909, 0.053400
#*# 	  0.015800, 0.010878, 0.002298, -0.000502, 0.001441, 0.004963, 0.003309, 0.000435, 0.001755, 0.007132, 0.011027, 0.012957, 0.018692, 0.026746, 0.038430, 0.046952, 0.049170, 0.047448, 0.049202, 0.051281, 0.054684
#*# 	  0.020429, 0.014131, 0.004478, 0.001600, 0.002821, 0.005207, 0.003259, 0.001015, 0.002090, 0.007865, 0.013412, 0.015012, 0.020229, 0.028018, 0.037532, 0.047228, 0.048105, 0.044775, 0.045381, 0.048223, 0.049214
#*# 	  0.018110, 0.011201, 0.001993, -0.000594, 0.000023, 0.001286, -0.000848, -0.003737, -0.001989, 0.005025, 0.010812, 0.011253, 0.015112, 0.022533, 0.032404, 0.039607, 0.039818, 0.036397, 0.036666, 0.037800, 0.039115
#*# 	  0.012793, 0.005538, -0.003545, -0.006306, -0.004514, -0.004363, -0.007249, -0.010229, -0.007833, -0.001549, 0.003278, 0.004235, 0.008618, 0.014959, 0.024725, 0.028967, 0.030180, 0.028422, 0.028050, 0.026383, 0.025277
#*# x_count = 21
#*# y_count = 21
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = direct
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 200.0
#*# min_y = 0.0
#*# max_y = 175.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 84.8
#*# shaper_type_y = ei
#*# shaper_freq_y = 89.2
